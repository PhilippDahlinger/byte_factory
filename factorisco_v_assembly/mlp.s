.text
.globl _start
_start:
	# print input

	#### First layer
	li a0, 10 
	li a7, 2
	ecall # sbrk for 10 words to store result of first layer
	mv s0, a0 # output address
	
	
	
	#### Second layer
	# iterate over 10 neurons
	li a0, 10 
	li a7, 2
	ecall # sbrk for 10 words to store result of second layer
	mv s4, a0 # output address
	
	
	
	# find out maximum
	# print output

	li a7, 1
	ecall
	
compute_layer:
	# a0: layer weight address
	# a1: layer bias address
	# a2: input address
	# a3: input size
	# a4: output address
	# a5: 0: no relu apply, 1: apply relu
	
	# a5 change it to 1: no relu apply, 0: relu apply
	xori a5, a5, 1
	
	# create stack with old s1-s3 and a0-a4
	addi sp, sp, -8
	sw a0, 7(sp)
	sw a1, 6(sp)
	sw a2, 5(sp)
	sw a3, 4(sp)
	sw a4, 3(sp)
	sw a5, 2(sp)
	sw s1, 1(sp)
	sw s2, 0(sp)
	
	
	li s1, 0 # neuron counter
	li s2, 10 # max neurons
	# iterate over the 10 neurons
	0:
	beq s1, s2, 1f
	# call compute neuron
	# take weight set -> add by s1 * weight size
	lw a3, 4(sp) # weight size
	lw a0, 7(sp) # weight base address
	lw a1, 6(sp) # bias base address
	lw a2, 5(sp) # input address
	mul t0, s1, a3
	add a0, a0, t0 # correct weight address
	add a1, a1, s1 # correct bias address
	lw a1, 0(a1) # load bias
	call compute_neuron # result is in a0
		
	lw a4, 3(sp) # load output address here for mem dependency resolve
	
	# activation function
	lw a5, 2(sp)
	bge a0, zero, 2f
	mul a0, a0, a5 # if a5 is 0: apply relu, if a5 is 1: do nothing
	2:
	
	# store result
	add a4, a4, s1
	sw a0, 0(a4)
	
	inc s1
	j 0b
	1:
	
	# pop stored values
	lw s1, 1(sp)
	lw s2, 0(sp)
	addi sp, sp, 8
	
compute_neuron:
	# a0: weight address
	# a1: bias value (int)
	# a2: input address
	# a3: input size (int)
	#returns value of neuron in a0
	# computes \sum_{i=0,..a3 - 1} (a0)[i] * ((a2)[i] + a1
	
	# Implementation: assumes input size % 2 = 0
	li t0, 0 # output sum
	li t1, 0 # counter i
	0:
	beq t1, a3, 1f
	# load weight i and i + 1
	add t2, a0, t1
	lw t3, 0(t2)
	lw t4, 1(t2)
	# load inputs i and i +1
	add t2, a2, t1
	lw t5, 0(t2)
	lw t6, 1(t2)
	# compute products and add to it
	mul t2, t3, t5
	add t0, t0, t2
	mul t2, t4, t6
	add t0, t0, t2
	
	# update counter
	addi t1, t1, 2
	j 0b
	1:
	# add bias and move output to a0
	add a0, t0, a1
	ret
	
	
	

	
.data
fc1.weight: .word -7, -82, 17, -48, 656, 865, 1096, -173, 78, -82, -68, -45, -5, -20, 484, 547, 192, -165, -90, -214, -154, 2334, -769, -21, -18, -728, -175, -11, 232, 125, 89, 94, 48, 50, 969, -58, 26, -413, -551, 234, 460, 533, 515, -102, -259, -14, 403, 370, -307, -46, 238, 648, 949, -124, -711, -818, -793, -430, 24, 58, 80, -52, 433, 254, -79, -324, 425, 255, 353, 350, -344, 1039, -66, 1012, -242, 206, 498, 664, 834, 333, 14, -411, -909, -828, -75, -125, -419, 21, 681, 877, 603, 32, -148, -483, 70, 62, -14, 14, -200, -358, -71, 332, 403, 71, 105, 28, 350, -3, -30, -917, -51, 235, -15, 194, 0, -128, -77, 608, 482, 43, 18, -1451, -650, -41, 128, 225, 296, 390, 868, 1852, -140, -6, 15, 1, -1352, -633, 1080, 150, 80, -485, -381, -336, -21, 57
.word -13, 59, -75, -46, -816, -872, -1180, -154, -20, -12, 69, -17, -26, -50, 425, 633, 1659, 1195, 959, 357, 97, -483, 635, -22, -77, 529, 589, 258, 46, 281, 511, 449, 206, -126, -1412, -50, 256, -307, -109, 433, 363, 55, 532, 482, 268, -129, -1302, 560, 52, 206, 234, -87, -613, -1602, 13, 206, -206, -341, -2304, 291, 74, -424, -2905, -2786, -1633, -1085, 351, -90, 122, 46, 395, 495, -49, -1126, -278, -204, 224, 595, 309, 8, -111, 366, 663, 1095, -17, 1033, 298, 133, 437, 546, -95, -85, -237, -585, 447, -77, 70, 504, 71, -68, 212, 543, 54, -81, -184, 110, 923, -59, 40, 1734, 1186, 520, 272, 123, 79, -250, -28, -169, -449, -11, -23, -362, 50, -82, 64, 154, 54, -328, -477, 51, -608, -48, 32, 3, 982, 876, -65, 266, 658, 1532, 470, -54, 28, -79
.word -65, -48, -78, 11, -105, -54, -196, -700, 3, -9, 27, 71, 20, -76, -1133, 541, 1035, 167, 80, 103, 523, -569, -978, -21, 75, 726, 97, -48, -59, 143, 83, 308, 363, 309, 226, -59, -109, -416, -81, -371, -58, 117, 411, 400, 248, 406, -61, -2, -716, -512, -543, -139, -170, -509, -580, -424, -677, -726, -258, -245, 21, -1654, 86, 199, 618, 306, 417, 236, -76, -853, -2453, -964, 0, 733, 607, 837, 791, 462, 32, 404, 186, -46, 539, 985, 82, 370, -402, -791, -448, -643, -317, 253, 413, 57, -274, -64, -48, 1137, 321, -1231, -1017, -703, -126, 128, 301, 94, -422, -38, 1, 640, 253, 347, 174, 60, -98, -116, -69, 163, 35, -48, -75, 1065, 939, 728, 628, 406, 148, 97, 118, 1400, 557, -82, 4, -48, -99, 471, -507, 14, 39, -326, 793, 143, -69, 80
.word -52, 74, 73, -51, -1103, -534, -1099, -788, -80, -12, -36, 30, 29, 52, 1170, 1393, 2074, 1009, 825, 633, 171, -6, 186, 44, -82, 193, 96, 835, 712, 61, 43, -15, -217, -258, -447, -48, -469, 788, 918, 430, 324, 45, 272, -313, -338, -224, -634, -960, -1237, 862, 533, -19, -59, -505, -481, -76, 201, -42, -2000, 252, 74, -31, -932, -426, 74, -169, -20, 421, 575, 611, 706, 1018, -43, -436, 798, 629, 633, 434, 485, 775, 607, 122, 207, 1118, -77, 189, 169, 428, 455, 236, 410, 792, 694, 799, 215, 72, -15, 1053, -235, -165, -50, 111, 545, 616, 227, 101, -267, -34, -7, 852, -433, -266, -224, 287, 95, -234, -177, -212, -575, 26, 11, 784, -842, -408, -261, -160, -11, 66, -58, 35, -916, -78, 16, 46, -427, 458, -1271, -592, -1306, -1132, -511, -332, 62, -29
.word 33, -14, -64, 73, 989, 773, 1119, 1009, 7, -78, 5, -13, -76, -9, 1289, 839, 858, 1069, 646, 110, 223, -191, -1099, -75, 55, 192, -501, 150, 137, 493, 769, 687, 372, -167, -318, 70, -28, -816, -624, 0, 209, 393, 899, 401, -112, -406, -392, 566, -657, -468, -78, 52, -199, -810, -225, -477, -188, 41, -526, 800, 41, -845, -141, -31, -173, 507, 1005, 381, 553, 762, 2388, 957, -63, -482, -168, -289, 315, 1255, 765, 0, -410, -344, -1018, -1031, -6, -413, -421, -184, 389, 242, -600, -330, -75, -506, -433, 77, 60, -707, 122, -344, -171, -147, 101, 268, 358, 418, -1436, -62, 80, -329, 935, 458, 233, 545, 393, -105, -177, -237, -732, -73, 71, 1315, -34, 160, 444, 554, 213, 446, 452, 483, -295, 63, -11, -26, -1106, 333, -75, 8, 255, 242, 409, 858, 52, -50
.word 27, -19, -65, -75, 229, -5, 230, 35, -35, -59, 82, 40, -3, -70, -303, -2270, -1853, -1949, -797, -1038, -816, -1695, 274, -55, 76, 680, -745, -217, -419, -475, -343, -159, -118, -35, -73, 5, 715, 923, 243, 313, 297, -32, -30, 306, 465, 727, 955, 190, 1278, -30, 288, 506, 196, -352, 209, 311, 100, 451, 799, -286, 23, 400, 498, 739, 624, 671, 1328, 607, 421, 213, -267, 63, 49, 194, -176, -242, 275, 868, 1005, 688, -110, 53, -1529, -9, -79, -1480, -1472, -959, -651, -114, 32, -150, -380, -1026, -1633, 23, -57, -66, -863, -857, -1037, -692, -176, -228, -748, -1137, -1011, 63, 7, -365, 257, 153, 64, 401, 245, -289, -518, -1778, -991, -77, 4, -534, 567, 586, 707, 744, 501, 342, 65, -1245, -1397, -6, -31, -28, 1192, 251, 357, -15, 163, -101, 230, 620, 63, -28
.word 6, 34, 41, -2, 1017, 977, 1199, 866, 46, -67, -39, 64, -9, 73, 1046, 1334, 625, 210, 596, 739, 1411, -383, -792, 27, -11, 709, 589, 382, 507, 112, -26, -248, -448, -792, -435, -51, 651, -9, -165, 204, 303, 632, 1171, -21, -586, -835, -825, 105, 1282, 23, 184, 132, 289, 324, 183, -776, -456, -239, -1439, -929, -66, -226, 134, -11, -182, -30, -81, 191, 243, 192, -685, 1120, 14, 89, -58, -220, -87, -204, -40, 153, 446, 293, 146, -1003, -21, 809, -475, -616, -307, -633, -30, 235, 661, 595, -228, -37, 32, -130, -181, -98, -432, 335, 884, 687, 462, -139, 86, 55, -28, 9, -461, -238, -119, 467, 229, -160, -464, -299, 608, -72, -80, 188, 774, 348, 114, 26, -15, 495, 465, 1372, 852, -15, 58, 0, 1250, 882, 659, 479, 997, 1160, 1446, 950, -33, -77
.word 61, 23, -3, 45, 951, 861, 1134, 977, -65, 17, 29, 45, 20, 71, -991, 254, 741, 677, 708, 795, 985, 1424, -395, -67, 49, -583, -437, 271, 304, -52, 95, 340, 353, 463, 1380, -36, 560, -599, 25, 468, 430, 35, -66, -394, -378, 353, 1255, -388, 544, -622, -122, 582, 501, -28, -158, -706, -453, 304, 1317, -151, -36, -413, 166, 436, 331, 618, -302, -549, -219, 53, 283, 697, 65, -842, -453, -267, 499, 653, 31, -257, 57, 625, 981, -1042, 5, -956, -666, -318, 217, -18, -406, -52, 212, 203, 210, -25, -63, -1005, -3, 818, 639, 929, 616, 534, -18, 138, -345, -42, 74, -388, -27, -50, 269, 892, 541, -148, -272, -634, -692, -48, 17, -1324, -692, -670, -223, 75, -38, -170, -516, -879, 129, -73, 66, -12, -750, -1487, -700, -274, -257, -809, -170, 44, 38, 55
.word -61, 68, -13, 37, -123, -738, -222, -333, -67, -23, 70, 11, -10, -43, -1292, 167, -44, -237, -494, -611, -427, -459, 962, -58, 50, -279, -260, 84, 572, 487, 439, 56, -365, -730, -434, 30, 538, 273, 278, 482, 863, 1048, 1359, 910, 585, 608, 303, 626, 1199, 979, 835, 649, 770, 140, 67, -5, 164, 225, 354, 571, 81, 379, -88, -277, -447, -750, -339, 37, 337, 154, -275, -689, 19, -315, -484, -369, -199, -164, -287, -72, -122, -473, -552, 1115, 64, 229, -244, -393, -96, -251, -500, 68, 71, 153, 675, 3, -21, -544, 865, 258, -216, -127, 119, -57, 16, 124, 324, -13, 67, -42, 414, 771, 370, 470, 128, -60, -114, 430, 668, -21, -69, -752, 64, 722, 1196, 1386, 1174, 903, 542, -134, 1499, 45, -72, -30, 1376, 756, 1736, 907, 1113, 1159, 1147, 818, -71, 32
.word 67, -44, -53, -76, -1010, -924, -1188, -848, 70, 55, -54, 13, 10, 37, 1052, 454, 106, 636, 952, 1018, 826, -41, 696, 49, -75, 683, 553, 403, 727, 181, 142, 111, 83, 75, 384, -22, -541, 68, 396, 696, 326, 11, -322, -502, -105, 431, 762, 166, -1108, 385, 350, 7, -147, 187, 224, -274, 24, 234, 192, 632, 51, 844, -622, -406, -64, 846, 691, -53, -277, -1028, -321, -221, 26, -787, -1462, -1043, -401, 647, 745, -84, -106, -168, 161, 1081, -76, 2123, -342, -806, -812, 159, 534, 156, 364, 762, 596, -73, -26, 1083, 665, 956, 164, -75, 456, 631, 416, 685, 338, -2, 54, 1108, -55, 33, -1, 214, 384, 338, 416, 66, 636, -82, -48, 1328, -448, -142, -153, 239, 317, 287, 435, -466, 958, -66, 68, 50, -721, 256, -42, 442, -48, -498, 254, -1070, -23, -39

fc1.bias: .word 648, 99, 151, 290, 799, 571, 858, 924, -90, 370

fc2.weight: .word -1354, -688, 383, 290, 365, -1167, -891, 1197, 1008, -1446
.word 327, 1228, -2338, -2294, 448, -120, 1509, -889, -1489, 477
.word -14, 1021, 45, 392, -75, -1424, -622, -283, 254, 424
.word -1352, 628, 804, 126, 320, -348, 36, -654, 290, 933
.word 670, -1146, 92, 872, -556, 637, -795, -437, -1121, -552
.word 3, -449, 1311, -795, -523, -541, -464, 694, 370, 499
.word 316, -441, -524, 236, 539, -901, 156, 728, -1806, -749
.word -91, 1290, -1166, -17, -1574, 1057, 968, -839, 404, -702
.word 379, -957, -692, -108, 883, -304, -1321, -126, 324, 282
.word 535, -1324, -307, 180, 263, 498, 269, -1224, -197, -890

fc2.bias: .word 579, 462, 350, -666, -114, 776, -708, 403, -910, 370

input_example: .word 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
	.word 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
	.word 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
	.word 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0
	.word 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0
	.word 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0
	.word 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0
	.word 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0
	.word 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0
	.word 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0
	.word 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0
	.word 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
